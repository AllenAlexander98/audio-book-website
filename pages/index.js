import Head from "next/head";
import Layout from "../components/layout/Layout";
// import RadioGroupRating from "../components/RadioGroupRating";
// import SelectOtherProps from "../components/SelectOtherProps";
// import Button from "@mui/material/Button";
// import Image from "next/image";
import HomeContent from "../components/HomeContent/HomeContent";
import useWindowSize from "../utils/useWindowSize";
import axios from "axios";

export default function Home({ categories, books }) {
  let windowSize = useWindowSize();
  return (
    <div>
      <Head>
        <title>Audio Book</title>
        <meta name="description" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <HomeContent
        open={true}
        windowSize={windowSize}
        categories={categories}
        books={books}
      />
    </div>
  );
}

//Layout
Home.layout = Layout;

export async function getServerSideProps(context) {
  let books = [];
  const res = await axios.get(`${process.env.NEXT_PUBLIC_API_URL}/categories`);
  if (res.status == 200) {
    if (res.data.success == true) {
      const categories = res.data.data;
      for (let i = 0; i < categories.length; i++) {
        const res = await axios.get(
          `${process.env.NEXT_PUBLIC_API_URL}/books/category/${categories[i]._id}`
        );
        if (res.status == 200) {
          if (res.data.success == true) {
            const data = res.data.data;
            data.forEach((book) => {
              books.push(book);
            });
          }
        }
      }
      return {
        props: {
          categories,
          books,
        },
      };
    }
  }
  return {
    props: {
      categories: [],
      books: [],
    },
  };
  //Handle error
}
